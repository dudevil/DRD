\documentclass{beamer}
\setbeamertemplate{navigation symbols}{}
%\usetheme{m}

\usepackage{beamerthemeshadow}
\usepackage{nth}
\usepackage[export]{adjustbox}
\usepackage{tikz}

\def\beamer@andinst{\quad}
\makeatother

\newcommand\parallelcontent[2]{
  \begin{columns}[t]
    \column{0.48\textwidth} #1
    \column{0.48\textwidth} #2
  \end{columns}
}
\newcommand\parallelitem[2]{
  \parallelcontent
  {\begin{itemize} \item #1 \end{itemize}}
  {\begin{itemize} \item[] #2 \end{itemize}}
}

\setbeamertemplate{caption}{\raggedright\insertcaption\par}

\usepackage{array}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\newcommand{\specialcell}[2][c]{\begin{tabular}[#1]{@{}c@{}}#2\end{tabular}}

\newcommand{\nomargincell}[2][c]{
	\setlength\tabcolsep{0pt}
	\renewcommand{\arraystretch}{0.1}
	\begin{tabular}[#1]{@{}c@{}}#2\end{tabular}
	}

\begin{document}
\title{Diabetic Retinopathy Detection}
\subtitle{}  
\author[]{Sergey Ovcharenko \inst{1} \and Rasim Akhunzyanov \inst{2}}
\institute[shortinst]{\inst{1} Deep Learning Engineer at NTech Lab \and \inst{2} Computer Vision Research Engineer at LG Electronics}

\date{\today} 

\begin{frame}
\titlepage
\end{frame}

\begin{frame}
\frametitle{Table of contents}\tableofcontents
\end{frame} 



% % % %
% % % % Overview
% % % %
\section{Overview} 

\subsection{Competition Details}
\begin{frame}\frametitle{Data} 
\par \textbf{Goal}: Identify signs of diabetic retinopathy in eye images
\par \textbf{Given}: 35126 images for training, 53576 images in test set
\par Images are big: 2500x2000
\par Compressed data size: 88Gb

\vspace{5pt}

\begin{tabular}{|@{}c@{}|@{}c@{}|@{}c@{}|@{}c@{}|@{}c@{}|}
\hline
	\includegraphics[width=0.2\textwidth]{pics/197_left_0.jpg} &
	\includegraphics[width=0.2\textwidth]{pics/204_right_1.jpg} &
	\includegraphics[width=0.2\textwidth]{pics/257_left_2.jpg} &
	\includegraphics[width=0.2\textwidth]{pics/328_right_3.jpg} &
	\includegraphics[width=0.2\textwidth]{pics/326_left_4.jpg} \\\noalign{\vspace{-0.15cm}}
\hline

Normal & Mild & Moderate & Severe & Proliferative \\

\hline
 \specialcell{25810\\ \footnotesize{73.48\%}}  & 
 \specialcell{2443\\\footnotesize6.96\%} & 
 \specialcell{5292\\\footnotesize15.07\%} & 
 \specialcell{873\\\footnotesize2.48\%} & 
 \specialcell{708\\\footnotesize2.01\%} \\

\hline
\end{tabular}

\end{frame}

\begin{frame}\frametitle{Quality metric: quadratic weighted kappa} 

\footnotesize { % TODO: rewrite
Images have five possible ratings, 0,1,2,3,4.  Each image is characterized by a tuple $ (e_a,e_b) $, which corresponds to its scores by $Rater A$ (human) and $Rater B$ (predicted).  The quadratic weighted kappa is calculated as follows. First, an $N\times N$ histogram matrix $O$ is constructed, such that $O_{i,j}$ corresponds to the number of images that received a rating $i$ by $A$ and a rating $j$ by $B$. An $N\times N$ matrix of weights, $w$, is calculated based on the difference between raters' scores:

\[ w_{i,j} = \frac{\left(i-j\right)^2}{\left(N-1\right)^2} \]

An $N\times N$ histogram matrix of expected ratings, $E$, is calculated, assuming that there is no correlation between rating scores.  This is calculated as the outer product between each rater's histogram vector of ratings, normalized such that $E$ and $O$ have the same sum.

From these three matrices, the quadratic weighted kappa is calculated as: 

\[ \kappa=1-\frac{\sum_{i,j}w_{i,j}O_{i,j}}{\sum_{i,j}w_{i,j}E_{i,j}}. \]
}

\end{frame}

\subsection{Competition Results}

\begin{frame}\frametitle{} 
\begin{center}
\only<1>{\includegraphics[width=\textwidth]{pics/private_lb_selected.pdf}}
\only<2>{\includegraphics[width=\textwidth]{pics/private_lb_distribution.pdf}}
\only<3>{\includegraphics[width=\textwidth]{pics/private_lb_score_increase.pdf}}
\end{center}
\end{frame}


%\begin{center}
%\includegraphics[width=\textwidth]{pics/LB_private.png}
%\end{center}
%\pause
%\begin{center}
%\includegraphics[width=\textwidth]{pics/private_lb_distribution.pdf}
%\end{center}
%\end{frame}

\begin{frame}\frametitle{} 
\par final leaderboard
\par + provide leaderboard histogram
\par + plot score over time
\end{frame}




% % % %
% % % % Solution
% % % %
\section{Solution}

\begin{frame}\frametitle{Domain knowledge: diabetic retinopathy symptoms}

\small Was prepared with assistance of ophthalmologist (Vera Shevchenko)

\begin{center}
\par \includegraphics[interpolate=true,valign=c,width=0.5\textwidth]{pics/symptoms_pic.png}
\vspace{5pt}
\par \hyperlink{https://goo.gl/s5lMt8}{Google Docs: https://goo.gl/s5lMt8}
\end{center}

\end{frame}

\subsection{Data preparation}


\begin{frame}\frametitle{Preprocessing}
\begin{columns}

\begin{column}{9cm}
\begin{itemize}
\item Crop black borders
\vspace{20pt}

\item Extent to square + resize
\vspace{20pt}

\item Optionally: crop internal square
\vspace{20pt}

\item Optionally: Local Contrast Normalization (LCN) \\ 
      $ \hat{I}_{x,y} = \frac{I_{x,y} - \mu_{x,y}}{\sigma_{x,y}} $
\end{itemize}
\end{column}

\begin{column}{6cm}
\begin{tabular}{ @{}c m{0.25cm} c }

	\includegraphics[valign=c,height=0.5cm]{pics/10_left.jpeg} & $\rightarrow$ &
    \includegraphics[valign=c,height=0.5cm]{pics/10_left.png}
    \vspace{10pt} \\ 
    
	\includegraphics[valign=c,height=0.5cm]{pics/10_left.png} & $\rightarrow$ &
    \includegraphics[valign=c,height=0.25cm]{pics/10_left.png}
	\vspace{10pt} \\ 	

	\adjustbox{valign=c}{\begin{tikzpicture}
	    \node[anchor=south west,inner sep=0] (image) at (0,0) {\includegraphics[valign=c,height=0.5cm]{pics/10_left.png}};
	        \begin{scope}[x={(image.south east)},y={(image.north west)}]
	            \draw[red] (0,0.5) -- (0.5,1) -- (1,0.5) -- (0.5,0) -- (0,0.5);
	        \end{scope}
	\end{tikzpicture}} & $\rightarrow$ &
	    \includegraphics[valign=c,height=0.5cm]{pics/10_left_inner.png}
    \vspace{10pt} \\

%    \includegraphics[valign=c,height=0.5cm]{pics/10_left.png} & $\rightarrow$ &
%    \includegraphics[valign=c,height=0.5cm]{pics/10_left_inner.png}
%	\vspace{10pt} \\

	\includegraphics[valign=c,height=0.5cm]{pics/10_left.png} & $\rightarrow$ &
	\includegraphics[valign=c,height=0.5cm]{pics/10_left_lcn.png}
	\\


\end{tabular}
\end{column}

\end{columns}
\end{frame}

\begin{frame}\frametitle{Augmentation}
\begin{itemize}
\item Random mirror
\item Random rotation
\item Color augmentation - not helped
\end{itemize}

\end{frame}

\subsection{Network configuration}
\begin{frame}\frametitle{}
\par Slice rotate
\par Merge
\par Output
\end{frame}

\subsection{Decision making}

\begin{frame}\frametitle{}
\par Predict score for eyes independently
\par Final score = max(left, right)
\end{frame}





% % % %
% % % % Winner's approaches
% % % %
\section{Winner's approaches} 
%\subsection{\nth{1} place}
\begin{frame}\frametitle{\nth{1} place}
\end{frame}
%\subsection{\nth{2} place}
\begin{frame}\frametitle{\nth{2} place}
\end{frame}
%\subsection{\nth{3} place}
\begin{frame}\frametitle{\nth{3} place}
\end{frame}









% % % %
% % % % Conclusions
% % % %
\section{Conclusions}
\begin{frame}\frametitle{Conclusions}
\end{frame}













%
%
% Back up
% There are examples below to use in slides
%

%\section{Back Up}
%
%\begin{frame}\frametitle{Tables}
%\begin{tabular}{|c|c|c|}
%\hline
%\textbf{Date} & \textbf{Instructor} & \textbf{Title} \\
%\hline
%WS 04/05 & Sascha Frank & First steps with  \LaTeX  \\
%\hline
%SS 05 & Sascha Frank & \LaTeX \ Course serial \\
%\hline
%\end{tabular}
%\end{frame}
%
%%\subsection{blocs}
%\begin{frame}\frametitle{blocs}
%
%\begin{block}{title of the bloc1}
%bloc text
%\end{block}
%
%\begin{exampleblock}{title of the bloc2}
%bloc text
%\end{exampleblock}
%
%
%\begin{alertblock}{title of the bloc3}
%bloc text
%\end{alertblock}
%
%\end{frame}
%
%%\subsection{split screen}
%
%\begin{frame}\frametitle{splitting screen}
%\begin{columns}
%\begin{column}{5cm}
%\begin{itemize}
%\item Beamer 
%\item Beamer Class 
%\item Beamer Class Latex 
%\end{itemize}
%\end{column}
%\begin{column}{5cm}
%\begin{tabular}{|c|c|}
%\hline
%\textbf{Instructor} & \textbf{Title} \\
%\hline
%Sascha Frank &  \LaTeX \ Course 1 \\
%\hline
%Sascha Frank &  Course serial  \\
%\hline
%\end{tabular}
%\end{column}
%\end{columns}
%\end{frame}
%
%%\subsection{Pictures} 
%\begin{frame}\frametitle{pictures in latex beamer class}
%\begin{figure}
%\includegraphics[scale=0.5]{pics/10_left.jpeg} 
%\caption{show an example picture}
%\end{figure}
%\end{frame}
%
%%\subsection{joining picture and lists} 
%
%\begin{frame}
%\frametitle{pictures and lists in beamer class}
%\begin{columns}
%\begin{column}{5cm}
%\begin{itemize}
%\item<1-> subject 1
%\item<3-> subject 2
%\item<5-> subject 3
%\end{itemize}
%\vspace{3cm} 
%\end{column}
%\begin{column}{5cm}
%\begin{overprint}
%\includegraphics<2>[width=2.5cm]{pics/10_left.jpeg}
%\includegraphics<4>[width=2.5cm]{pics/10_left.jpeg}
%\includegraphics<6>[width=2.5cm]{pics/10_left.jpeg}
%\end{overprint}
%\end{column}
%\end{columns}
%\end{frame}
%
%
%%\subsection{pictures which need more space} 
%\begin{frame}[plain]
%\frametitle{plain, or a way to get more space}
%\begin{figure}
%\includegraphics[scale=0.25]{pics/10_left.jpeg} 
%\caption{show an example picture}
%\end{figure}
%\end{frame}
%
%
%
%
%
%

\end{document}