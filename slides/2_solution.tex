% % % %
% % % % Solution
% % % %
\section{Solution}

\begin{frame}\frametitle{Domain knowledge: diabetic retinopathy symptoms}

\begin{itemize}
\item {\hyperlink{https://goo.gl/s5lMt8}{DR symptoms cheatsheet: https://goo.gl/s5lMt8}
\begin{center}
\par \includegraphics[interpolate=true,valign=c,width=0.4\textwidth]{pics/symptoms_pic.png}
\end{center}
Was prepared with assistance of Vera Shevchenko
}
\item \href{http://www.icoph.org/downloads/Diabetic-Retinopathy-Detail.pdf}{International Clinical Diabetic Retinopathy Disease Severity Scale, Detailed Table: \small http://www.icoph.org/downloads/Diabetic-Retinopathy-Detail.pdf}
\end{itemize}

\end{frame}

\subsection{Data preparation}


\begin{frame}\frametitle{Preprocessing}
\begin{columns}

\begin{column}{9cm}
\begin{itemize}
\item Crop black borders
\vspace{20pt}

\item Extent to square + resize
\vspace{20pt}

\item Optionally: crop internal square
\vspace{20pt}

\item Optionally: Local Contrast Normalization (LCN) \\ 
      $ \hat{I}_{x,y} = \frac{I_{x,y} - \mu_{x,y}}{\sigma_{x,y}} $
\end{itemize}
\end{column}

\begin{column}{6cm}
\begin{tabular}{ @{}c m{0.25cm} c }

	\includegraphics[valign=c,height=0.5cm]{pics/10_left.jpeg} & $\rightarrow$ &
    \includegraphics[valign=c,height=0.5cm]{pics/10_left.png}
    \vspace{10pt} \\ 
    
	\includegraphics[valign=c,height=0.5cm]{pics/10_left.png} & $\rightarrow$ &
    \includegraphics[valign=c,height=0.25cm]{pics/10_left.png}
	\vspace{10pt} \\ 	

	\adjustbox{valign=c}{\begin{tikzpicture}
	    \node[anchor=south west,inner sep=0] (image) at (0,0) {\includegraphics[valign=c,height=0.5cm]{pics/10_left.png}};
	        \begin{scope}[x={(image.south east)},y={(image.north west)}]
	            \draw[red] (0,0.5) -- (0.5,1) -- (1,0.5) -- (0.5,0) -- (0,0.5);
	        \end{scope}
	\end{tikzpicture}} & $\rightarrow$ &
	    \includegraphics[valign=c,height=0.5cm]{pics/10_left_inner.png}
    \vspace{10pt} \\

%    \includegraphics[valign=c,height=0.5cm]{pics/10_left.png} & $\rightarrow$ &
%    \includegraphics[valign=c,height=0.5cm]{pics/10_left_inner.png}
%	\vspace{10pt} \\

	\includegraphics[valign=c,height=0.5cm]{pics/10_left.png} & $\rightarrow$ &
	\includegraphics[valign=c,height=0.5cm]{pics/10_left_lcn.png}
	\\


\end{tabular}
\end{column}

\end{columns}
\end{frame}

\begin{frame}\frametitle{Augmentation}
\begin{itemize}
\item Random mirror
\item Random rotation
\item Color augmentation - not helped
\end{itemize}

\end{frame}

\subsection{Network configuration}
\begin{frame}\frametitle{}
\par Slice rotate
\par Merge
\par Output
\end{frame}

\subsection{Network configuration}
\begin{frame}\frametitle{}

\begin{table}[]
\tiny	
\centering
\begin{tabular}{@{}lll@{}}
Layer type & Size & Output shape \\
cyclic slice &  & (128, 1, 95, 95) \\
convolution & 32 3x3 filters & (128, 32, 95, 95) \\
convolution & 16 3x3 filters & (128, 16, 95, 95) \\
max pooling & 3x3, stride 2 & (128, 16, 47, 47) \\
cyclic roll &  & (128, 64, 47, 47) \\
convolution & 64 3x3 filters & (128, 64, 47, 47) \\
convolution & 32 3x3 filters & (128, 32, 47, 47) \\
max pooling & 3x3, stride 2 & (128, 32, 23, 23) \\
cyclic roll &  & (128, 128, 23, 23) \\
convolution & 128 3x3 filters & (128, 128, 23, 23) \\
convolution & 128 3x3 filters & (128, 128, 23, 23) \\
convolution & 64 3x3 filters & (128, 64, 23, 23) \\
max pooling & 3x3, stride 2 & (128, 64, 11, 11) \\
cyclic roll &  & (128, 256, 11, 11) \\
convolution & 256 3x3 filters & (128, 256, 11, 11) \\
convolution & 256 3x3 filters & (128, 256, 11, 11) \\
convolution & 128 3x3 filters & (128, 128, 11, 11) \\
max pooling & 3x3, stride 2 & (128, 128, 5, 5) \\
cyclic roll &  & (128, 512, 5, 5) \\
fully connected & 512 2-piece maxout units & (128, 512) \\
cyclic pooling (rms) &  & (32, 512) \\
fully connected & 512 2-piece maxout units & (32, 512) \\
fully connected & 121-way softmax & (32, 121)
\end{tabular}
\end{table}
\end{frame}


\subsection{Decision making}

\begin{frame}\frametitle{}
\par Predict score for eyes independently
\par Final score = max(left, right)
\end{frame}


\input{2_2_ma_detection}